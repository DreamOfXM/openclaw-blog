{% extends "base.html" %}

{% block title %}ç®¡ç†åå° - è¯´ç‚¹å•¥ Â· æŠ€èƒ½ç¬”è®°{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">
    <div style="margin-bottom: 2rem;">
        <h1 style="font-size: 1.75rem; font-weight: bold; margin-bottom: 0.5rem;">ç®¡ç†åå°</h1>
        <p style="color: var(--text-light);">ç®¡ç†æ‚¨çš„åšå®¢æ–‡ç« å’Œè®¾ç½®</p>
    </div>
    
    <div class="grid md:grid-cols-4 gap-6 mb-6">
        <div class="card text-center">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“</div>
            <div style="font-size: 2rem; font-weight: bold;">{{ articles|length }}</div>
            <div style="color: var(--text-light);">æ–‡ç« æ€»æ•°</div>
        </div>
        
        {% set public_count = articles|selectattr('visibility', 'equalto', 'public')|list|length %}
        <div class="card text-center">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸŒ</div>
            <div style="font-size: 2rem; font-weight: bold;">{{ public_count }}</div>
            <div style="color: var(--text-light);">å…¬å¼€æ–‡ç« </div>
        </div>
        
        {% set private_count = articles|selectattr('visibility', 'equalto', 'private')|list|length %}
        <div class="card text-center">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ”’</div>
            <div style="font-size: 2rem; font-weight: bold;">{{ private_count }}</div>
            <div style="color: var(--text-light);">ç§å¯†æ–‡ç« </div>
        </div>
        
        {% set password_count = articles|selectattr('visibility', 'equalto', 'password')|list|length %}
        <div class="card text-center">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ”‘</div>
            <div style="font-size: 2rem; font-weight: bold;">{{ password_count }}</div>
            <div style="color: var(--text-light);">å¯†ç ä¿æŠ¤</div>
        </div>
    </div>
    
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2 style="font-size: 1.25rem; font-weight: 600;">æ–‡ç« ç®¡ç†</h2>
            <button onclick="showNewArticleForm()" class="btn">+ æ–°å»ºæ–‡ç« </button>
        </div>
        
        {% if articles %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f8fafc; border-bottom: 2px solid var(--border);">
                            <th style="padding: 0.75rem; text-align: left;">æ ‡é¢˜</th>
                            <th style="padding: 0.75rem; text-align: left;">å¯è§æ€§</th>
                            <th style="padding: 0.75rem; text-align: left;">åˆ›å»ºæ—¶é—´</th>
                            <th style="padding: 0.75rem; text-align: left;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for article in articles %}
                            <tr style="border-bottom: 1px solid var(--border);">
                                <td style="padding: 0.75rem;">
                                    <div style="font-weight: 500;">{{ article.title }}</div>
                                    {% if article.slug %}
                                        <div style="font-size: 0.85rem; color: var(--text-light);">
                                            /{{ article.slug }}
                                        </div>
                                    {% endif %}
                                </td>
                                <td style="padding: 0.75rem;">
                                    {% if article.visibility == 'public' %}
                                        <span style="color: var(--success);">å…¬å¼€</span>
                                    {% elif article.visibility == 'private' %}
                                        <span style="color: var(--warning);">ç§å¯†</span>
                                    {% elif article.visibility == 'password' %}
                                        <span style="color: var(--accent);">å¯†ç ä¿æŠ¤</span>
                                    {% endif %}
                                </td>
                                <td style="padding: 0.75rem;">{{ article.created_at[:10] }}</td>
                                <td style="padding: 0.75rem;">
                                    <div style="display: flex; gap: 0.5rem;">
                                        <a href="{{ url_for('view_post', slug=article.slug) }}" 
                                           style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">
                                            æŸ¥çœ‹
                                        </a>
                                        <span style="color: var(--border);">|</span>
                                        <a href="{{ url_for('logout') }}" 
                                           style="color: var(--danger); text-decoration: none; font-size: 0.9rem;">
                                            åˆ é™¤
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div style="text-align: center; padding: 3rem;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“</div>
                <h3 style="margin-bottom: 0.5rem;">è¿˜æ²¡æœ‰æ–‡ç« </h3>
                <p style="color: var(--text-light); margin-bottom: 1.5rem;">
                    åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ç¯‡æ–‡ç« å§ï¼
                </p>
                <button onclick="showNewArticleForm()" class="btn">+ æ–°å»ºæ–‡ç« </button>
            </div>
        {% endif %}
    </div>
    
    <div style="margin-top: 2rem; display: flex; gap: 1rem;">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">è¿”å›é¦–é¡µ</a>
        <a href="{{ url_for('logout') }}" class="btn">é€€å‡ºç™»å½•</a>
    </div>
</div>

<!-- æ–°å»ºæ–‡ç« è¡¨å•ï¼ˆéšè—ï¼‰ -->
<div id="newArticleForm" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div class="card" style="max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2 style="font-size: 1.25rem; font-weight: 600;">æ–°å»ºæ–‡ç« </h2>
            <button onclick="hideNewArticleForm()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-light);">Ã—</button>
        </div>
        
        <div style="color: var(--text-light); margin-bottom: 1.5rem; font-size: 0.9rem;">
            ç”±äºè¿™æ˜¯æ¼”ç¤ºç‰ˆæœ¬ï¼Œåˆ›å»ºæ–‡ç« åŠŸèƒ½éœ€è¦åœ¨åç»­ç‰ˆæœ¬ä¸­å®ç°ã€‚æ‚¨å¯ä»¥å…ˆæ‰‹åŠ¨åœ¨æ•°æ®åº“ä¸­æ·»åŠ æ–‡ç« ã€‚
        </div>
        
        <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
            <h3 style="font-weight: 600; margin-bottom: 0.5rem;">æ‰‹åŠ¨æ·»åŠ æ–‡ç« ç¤ºä¾‹</h3>
            <pre style="background: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 4px; overflow-x: auto; font-size: 0.85rem;">
INSERT INTO articles (title, slug, content, excerpt, visibility, tags) 
VALUES (
    'æ–‡ç« æ ‡é¢˜',
    'article-slug',
    '&lt;h2&gt;æ–‡ç« å†…å®¹&lt;/h2&gt;&lt;p&gt;è¿™é‡Œæ˜¯æ–‡ç« å†…å®¹...&lt;/p&gt;',
    'æ–‡ç« æ‘˜è¦',
    'public',
    'æ ‡ç­¾1,æ ‡ç­¾2'
);</pre>
        </div>
        
        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
            <button onclick="hideNewArticleForm()" class="btn btn-secondary">å–æ¶ˆ</button>
            <button onclick="alert('åˆ›å»ºæ–‡ç« åŠŸèƒ½å°†åœ¨åç»­ç‰ˆæœ¬ä¸­æ·»åŠ ')" class="btn">äº†è§£</button>
        </div>
    </div>
</div>

<script>
function showNewArticleForm() {
    document.getElementById('newArticleForm').style.display = 'flex';
}

function hideNewArticleForm() {
    document.getElementById('newArticleForm').style.display = 'none';
}

// ç‚¹å‡»èƒŒæ™¯å…³é—­è¡¨å•
document.getElementById('newArticleForm').addEventListener('click', function(e) {
    if (e.target === this) {
        hideNewArticleForm();
    }
});
</script>
{% endblock %}